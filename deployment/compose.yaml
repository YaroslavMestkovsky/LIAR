version: '3.8'

services:
  python-ssh:
    build:
      args:
        - USER_GID=${USER_GID}
      dockerfile: ./Dockerfile
    container_name: python-ssh
    volumes:
      - ../app:/app
      - ./start.sh:/start.sh
    privileged: true
    networks:
      local_net:
        ipv4_address: 172.30.1.1
    ports:
      - "8000:8000"
      - "50000:22"
    tty: true
    command: "/bin/sh start.sh"

  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"  # HTTP API
      - "6334:6334"  # gRPC API
    volumes:
      - ../qdrant_data:/qdrant/storage
    environment:
      QDRANT__SERVICE__HTTP_PORT: 6333
      QDRANT__SERVICE__GRPC_PORT: 6334
    networks:
      local_net:
        ipv4_address: 172.30.1.2

networks:
  local_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.30.0.0/16
